<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MULINHUA æœ‹å‹åœˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      background: #f7f8fa;
      color: #222;
    }
    header {
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 1.2rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .logo {
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 2px;
      color: #1a73e8;
    }
    .admin-btn, .notify-btn {
      background: #1a73e8;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      margin-left: 1rem;
      transition: background 0.2s;
    }
    .admin-btn:hover, .notify-btn:hover {
      background: #155ab6;
    }
    main {
      max-width: 600px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .post {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      margin-bottom: 1.5rem;
      padding: 1.2rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }
    .post .author {
      font-weight: 700;
      color: #1a73e8;
      font-size: 1.1rem;
    }
    .post .content {
      font-size: 1.05rem;
      line-height: 1.7;
    }
    .post img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 0.5rem;
    }
    @media (max-width: 700px) {
      main { max-width: 100%; }
      header { padding: 1rem; }
    }
    .admin-panel {
      display: none;
      flex-direction: column;
      gap: 1rem;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .admin-panel input, .admin-panel textarea {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-size: 1rem;
    }
    .admin-panel label {
      font-weight: 600;
      margin-bottom: 0.3rem;
      display: block;
    }
    .admin-panel .submit-btn {
      background: #1a73e8;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    .admin-panel .submit-btn:hover {
      background: #155ab6;
    }
  </style>
</head>
<body>
  <header>
    <span class="logo">MULINHUA æœ‹å‹åœˆ</span>
    <div>
      <button class="notify-btn" onclick="requestNotify()">ğŸ””<span id="notifyCount" style="font-size:0.9em;background:#e53935;color:#fff;border-radius:50%;padding:0 6px;margin-right:4px;display:none;">0</span>é€šçŸ¥</button>
      <button class="admin-btn" id="memberBtn" onclick="showMemberCenter()">ä¼šå‘˜ä¸­å¿ƒ</button>
      <button class="admin-btn" id="loginBtn" onclick="showUserLoginModal()">ç™»å½•/æ³¨å†Œ</button>
      <button class="admin-btn" id="adminBtn" onclick="showLoginModal()">ç®¡ç†å‘˜å…¥å£</button>
      <button class="admin-btn" id="logoutBtn" style="display:none;" onclick="logoutAdmin()">é€€å‡ºç™»å½•</button>
    </div>
  </header>
  <main>
    <div class="admin-panel" id="adminPanel">
      <form id="postForm" onsubmit="return submitPost(event)">
        <label>å†…å®¹</label>
        <textarea id="postContent" rows="3" required placeholder="è¯·è¾“å…¥å†…å®¹..."></textarea>
        <label>å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</label>
        <input type="file" id="postImage" accept="image/*">
        <button class="submit-btn" type="submit">å‘å¸ƒ</button>
      </form>
    </div>
    <div id="feed">
      <!-- åŠ¨æ€å†…å®¹æµ -->
    </div>
  </main>
  <!-- ç”¨æˆ·ç™»å½•/æ³¨å†Œå¼¹çª— -->
  <div id="userLoginModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);z-index:101;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:2rem 2.2rem;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.08);min-width:260px;max-width:90vw;display:flex;flex-direction:column;gap:1.2rem;">
      <div style="font-weight:700;font-size:1.2rem;color:#1a73e8;">ç”¨æˆ·ç™»å½•/æ³¨å†Œ</div>
      <input id="userLoginUser" type="text" placeholder="ç”¨æˆ·å/æ‰‹æœºå·/é‚®ç®±" style="padding:0.7rem;border:1px solid #e0e0e0;border-radius:6px;font-size:1rem;">
      <input id="userLoginPwd" type="password" placeholder="å¯†ç " style="padding:0.7rem;border:1px solid #e0e0e0;border-radius:6px;font-size:1rem;">
      <div id="userLoginError" style="color:#e53935;font-size:0.98rem;display:none;"></div>
      <button class="submit-btn" onclick="return userLogin(event)">ç™»å½•</button>
      <button class="submit-btn" style="background:#eee;color:#333;" onclick="closeUserLoginModal();return false;">å–æ¶ˆ</button>
      <div style="text-align:center;color:#888;font-size:0.98rem;">æˆ–ä½¿ç”¨ç¤¾äº¤è´¦å·ç™»å½•</div>
      <div style="display:flex;gap:1rem;justify-content:center;">
        <button class="submit-btn" style="background:#07c160;" onclick="alert('å¾®ä¿¡ç™»å½•æš‚æœªæ¥å…¥')">å¾®ä¿¡</button>
        <button class="submit-btn" style="background:#498ad5;" onclick="alert('QQç™»å½•æš‚æœªæ¥å…¥')">QQ</button>
        <button class="submit-btn" style="background:#e6162d;" onclick="alert('å¾®åšç™»å½•æš‚æœªæ¥å…¥')">å¾®åš</button>
      </div>
    </div>
  </div>
  <!-- ä¼šå‘˜ä¸­å¿ƒå¼¹çª— -->
  <div id="memberCenterModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);z-index:102;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:2rem 2.2rem;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.08);min-width:260px;max-width:90vw;display:flex;flex-direction:column;gap:1.2rem;">
      <div style="font-weight:700;font-size:1.2rem;color:#1a73e8;">ä¼šå‘˜ä¸­å¿ƒ</div>
      <div id="memberInfo">è¯·å…ˆç™»å½•</div>
      <button class="submit-btn" style="background:#eee;color:#333;" onclick="closeMemberCenter();return false;">å…³é—­</button>
    </div>
  </div>
  <!-- ç®¡ç†å‘˜ç™»å½•å¼¹çª— -->
  <div id="loginModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);z-index:100;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:2rem 2.2rem;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.08);min-width:260px;max-width:90vw;display:flex;flex-direction:column;gap:1.2rem;">
      <div style="font-weight:700;font-size:1.2rem;color:#1a73e8;">ç®¡ç†å‘˜ç™»å½•</div>
      <input id="loginUser" type="text" placeholder="è´¦æˆ·" style="padding:0.7rem;border:1px solid #e0e0e0;border-radius:6px;font-size:1rem;">
      <input id="loginPwd" type="password" placeholder="å¯†ç " style="padding:0.7rem;border:1px solid #e0e0e0;border-radius:6px;font-size:1rem;">
      <div id="loginError" style="color:#e53935;font-size:0.98rem;display:none;"></div>
      <button class="submit-btn" onclick="return loginAdmin(event)">ç™»å½•</button>
      <button class="submit-btn" style="background:#eee;color:#333;" onclick="closeLoginModal();return false;">å–æ¶ˆ</button>
    </div>
  </div>
  <script>
    // ç®¡ç†å‘˜é¢æ¿æ˜¾ç¤º/éšè—
    function toggleAdminPanel() {
      const panel = document.getElementById('adminPanel');
      panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
    }
    // è·å–é€šçŸ¥æƒé™
    function requestNotify() {
      if (!('Notification' in window)) {
        alert('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½');
        return;
      }
      Notification.requestPermission().then(function(permission) {
        if (permission === 'granted') {
          alert('é€šçŸ¥æƒé™å·²è·å–ï¼');
        } else {
          alert('é€šçŸ¥æƒé™è¢«æ‹’ç»');
        }
      });
    }
    // ç®€å•çš„æœ¬åœ°å†…å®¹æµï¼ˆå¯æ›¿æ¢ä¸ºåç«¯APIï¼‰
    const demoPosts = [
      {
        author: 'ç®¡ç†å‘˜',
        content: 'æ¬¢è¿æ¥åˆ° MULINHUA æœ‹å‹åœˆï¼',
        image: ''
      },
      {
        author: 'ç®¡ç†å‘˜',
        content: 'æ”¯æŒæ‰‹æœºæ¨é€é€šçŸ¥ï¼Œè®°å¾—ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è·å–æƒé™ã€‚',
        image: ''
      }
    ];
    function renderFeed() {
      const feed = document.getElementById('feed');
      feed.innerHTML = '';
      demoPosts.slice().reverse().forEach((post, idx) => {
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `<div class="author">${post.author}</div>
          <div class="content">${post.content}</div>
          ${post.image ? `<img src="${post.image}" alt="å›¾ç‰‡">` : ''}
          <div style="display:flex;gap:1rem;align-items:center;margin-top:0.5rem;">
            <button onclick="likePost(${idx})">ğŸ‘<span id="like${idx}">${post.likes||0}</span></button>
            <button onclick="favPost(${idx})">â­<span id="fav${idx}">${post.favs||0}</span></button>
            <button onclick="sharePost(${idx})">ğŸ”—åˆ†äº«</button>
          </div>
          <div style="margin-top:0.5rem;">
            <b>æ ‡ç­¾ï¼š</b>${post.tags||'æ— '}
            <b style="margin-left:1em;">åˆ†ç±»ï¼š</b>${post.category||'æœªåˆ†ç±»'}
            <b style="margin-left:1em;">å½’æ¡£ï¼š</b>${post.archive||'2025-06'}
            ${post.top?' <span style="color:#e53935;font-weight:700;">[ç½®é¡¶]</span>':''}
            ${post.recommend?' <span style="color:#1a73e8;font-weight:700;">[æ¨è]</span>':''}
          </div>
          <div style="margin-top:0.5rem;"><b>ç›¸å…³æ–‡ç« ï¼š</b>${post.related||'æ— '}</div>
          <div style="margin-top:0.5rem;">
            <b>è¯„è®ºï¼š</b>
            <div id="comments${idx}">${(post.comments||[]).map(c=>`<div style='border-bottom:1px solid #eee;padding:2px 0;'><b>${c.user}ï¼š</b>${c.text}</div>`).join('')}</div>
            <form onsubmit="return addComment(event,${idx})" style="display:flex;gap:0.5rem;margin-top:0.3rem;">
              <input type="text" id="commentInput${idx}" placeholder="å†™è¯„è®º..." style="flex:1;padding:0.3rem 0.5rem;border-radius:4px;border:1px solid #eee;">
              <button type="submit">å‘é€</button>
            </form>
          </div>
        `;
        feed.appendChild(div);
      });
    }
    renderFeed();
    // ç®¡ç†å‘˜å‘å¸ƒå†…å®¹ï¼ˆæœ¬åœ°æ¼”ç¤ºï¼‰
    function submitPost(e) {
      e.preventDefault();
      const content = document.getElementById('postContent').value.trim();
      const imageInput = document.getElementById('postImage');
      if (!content) return false;
      if (imageInput.files && imageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          demoPosts.push({ author: 'ç®¡ç†å‘˜', content, image: evt.target.result });
          renderFeed();
        };
        reader.readAsDataURL(imageInput.files[0]);
      } else {
        demoPosts.push({ author: 'ç®¡ç†å‘˜', content, image: '' });
        renderFeed();
      }
      document.getElementById('postForm').reset();
      return false;
    }
    // ç®¡ç†å‘˜ç™»å½•é€»è¾‘
    const ADMIN_USER = 'admin';
    const ADMIN_PWD = 'mulin2025';
    function isAdminLoggedIn() {
      return localStorage.getItem('mlh_admin') === '1';
    }
    function showLoginModal() {
      if (isAdminLoggedIn()) {
        document.getElementById('adminPanel').style.display = 'flex';
        return;
      }
      document.getElementById('loginModal').style.display = 'flex';
      document.getElementById('loginError').style.display = 'none';
      document.getElementById('loginUser').value = '';
      document.getElementById('loginPwd').value = '';
    }
    function closeLoginModal() {
      document.getElementById('loginModal').style.display = 'none';
    }
    function loginAdmin(e) {
      e.preventDefault();
      const user = document.getElementById('loginUser').value.trim();
      const pwd = document.getElementById('loginPwd').value;
      if (user === ADMIN_USER && pwd === ADMIN_PWD) {
        localStorage.setItem('mlh_admin', '1');
        document.getElementById('adminPanel').style.display = 'flex';
        document.getElementById('adminBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
        closeLoginModal();
      } else {
        document.getElementById('loginError').innerText = 'è´¦æˆ·æˆ–å¯†ç é”™è¯¯';
        document.getElementById('loginError').style.display = 'block';
      }
      return false;
    }
    function logoutAdmin() {
      localStorage.removeItem('mlh_admin');
      document.getElementById('adminPanel').style.display = 'none';
      document.getElementById('adminBtn').style.display = 'inline-block';
      document.getElementById('logoutBtn').style.display = 'none';
    }
    // ç”¨æˆ·ç™»å½•/æ³¨å†Œå¼¹çª—é€»è¾‘
    function showUserLoginModal() {
      document.getElementById('userLoginModal').style.display = 'flex';
      document.getElementById('userLoginError').style.display = 'none';
      document.getElementById('userLoginUser').value = '';
      document.getElementById('userLoginPwd').value = '';
    }
    function closeUserLoginModal() {
      document.getElementById('userLoginModal').style.display = 'none';
    }
    function userLogin(e) {
      e.preventDefault();
      // è¿™é‡Œåªåšæœ¬åœ°æ¼”ç¤ºï¼Œå®é™…åº”è°ƒç”¨åç«¯API
      const user = document.getElementById('userLoginUser').value.trim();
      const pwd = document.getElementById('userLoginPwd').value;
      if (user && pwd) {
        localStorage.setItem('mlh_user', user);
        closeUserLoginModal();
        updateMemberInfo();
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('memberBtn').style.display = 'inline-block';
      } else {
        document.getElementById('userLoginError').innerText = 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ';
        document.getElementById('userLoginError').style.display = 'block';
      }
      return false;
    }
    // ä¼šå‘˜ä¸­å¿ƒé€»è¾‘
    function showMemberCenter() {
      document.getElementById('memberCenterModal').style.display = 'flex';
      updateMemberInfo();
    }
    function closeMemberCenter() {
      document.getElementById('memberCenterModal').style.display = 'none';
    }
    function updateMemberInfo() {
      const user = localStorage.getItem('mlh_user');
      document.getElementById('memberInfo').innerText = user ? `æ¬¢è¿ï¼Œ${user}` : 'è¯·å…ˆç™»å½•';
    }
    // é¡µé¢åŠ è½½æ—¶æ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤ºç”¨æˆ·æŒ‰é’®
    window.onload = function() {
      if (isAdminLoggedIn()) {
        document.getElementById('adminPanel').style.display = 'flex';
        document.getElementById('adminBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
      } else {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('adminBtn').style.display = 'inline-block';
        document.getElementById('logoutBtn').style.display = 'none';
      }
      if (localStorage.getItem('mlh_user')) {
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('memberBtn').style.display = 'inline-block';
      } else {
        document.getElementById('loginBtn').style.display = 'inline-block';
        document.getElementById('memberBtn').style.display = 'none';
      }
    }
    function likePost(idx) {
      demoPosts[idx].likes = (demoPosts[idx].likes||0)+1;
      document.getElementById('like'+idx).innerText = demoPosts[idx].likes;
    }
    function favPost(idx) {
      demoPosts[idx].favs = (demoPosts[idx].favs||0)+1;
      document.getElementById('fav'+idx).innerText = demoPosts[idx].favs;
    }
    function sharePost(idx) {
      alert('åˆ†äº«åŠŸèƒ½ä»…ä¸ºæ¼”ç¤ºï¼Œå¯å¯¹æ¥å¾®ä¿¡/QQ/å¾®åš/å¤åˆ¶é“¾æ¥ç­‰');
    }
    function addComment(e, idx) {
      e.preventDefault();
      const input = document.getElementById('commentInput'+idx);
      const text = input.value.trim();
      if (!text) return false;
      if (!demoPosts[idx].comments) demoPosts[idx].comments = [];
      const user = localStorage.getItem('mlh_user') || 'æ¸¸å®¢';
      demoPosts[idx].comments.push({user, text});
      renderFeed();
      return false;
    }
  </script>
</body>
</html>
