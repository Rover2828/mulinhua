<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MULINHUA 朋友圈</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      background: #f7f8fa;
      color: #222;
    }
    header {
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 1.2rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .logo {
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 2px;
      color: #1a73e8;
    }
    .admin-btn, .notify-btn {
      background: #1a73e8;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      margin-left: 1rem;
      transition: background 0.2s;
    }
    .admin-btn:hover, .notify-btn:hover {
      background: #155ab6;
    }
    main {
      max-width: 600px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .post {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      margin-bottom: 1.5rem;
      padding: 1.2rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }
    .post .author {
      font-weight: 700;
      color: #1a73e8;
      font-size: 1.1rem;
    }
    .post .content {
      font-size: 1.05rem;
      line-height: 1.7;
    }
    .post img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 0.5rem;
    }
    @media (max-width: 700px) {
      main { max-width: 100%; }
      header { padding: 1rem; }
    }
    .admin-panel {
      display: none;
      flex-direction: column;
      gap: 1rem;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .admin-panel input, .admin-panel textarea {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-size: 1rem;
    }
    .admin-panel label {
      font-weight: 600;
      margin-bottom: 0.3rem;
      display: block;
    }
    .admin-panel .submit-btn {
      background: #1a73e8;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    .admin-panel .submit-btn:hover {
      background: #155ab6;
    }
  </style>
</head>
<body>
  <header>
    <span class="logo">MULINHUA 朋友圈</span>
    <div>
      <button class="notify-btn" onclick="requestNotify()">🔔<span id="notifyCount" style="font-size:0.9em;background:#e53935;color:#fff;border-radius:50%;padding:0 6px;margin-right:4px;display:none;">0</span>通知</button>
      <button class="admin-btn" id="memberBtn" onclick="showMemberCenter()">会员中心</button>
      <button class="admin-btn" id="loginBtn" onclick="showUserLoginModal()">登录/注册</button>
      <button class="admin-btn" id="adminBtn" onclick="showLoginModal()">管理员入口</button>
      <button class="admin-btn" id="logoutBtn" style="display:none;" onclick="logoutAdmin()">退出登录</button>
    </div>
  </header>
  <main>
    <div class="admin-panel" id="adminPanel">
      <form id="postForm" onsubmit="return submitPost(event)">
        <label>内容</label>
        <textarea id="postContent" rows="3" required placeholder="请输入内容..."></textarea>
        <label>图片（可选）</label>
        <input type="file" id="postImage" accept="image/*">
        <button class="submit-btn" type="submit">发布</button>
      </form>
    </div>
    <div id="feed">
      <!-- 动态内容流 -->
    </div>
  </main>
  <!-- 用户登录/注册弹窗 -->
  <div id="userLoginModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);z-index:101;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:2rem 2.2rem;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.08);min-width:260px;max-width:90vw;display:flex;flex-direction:column;gap:1.2rem;">
      <div style="font-weight:700;font-size:1.2rem;color:#1a73e8;">用户登录/注册</div>
      <input id="userLoginUser" type="text" placeholder="用户名/手机号/邮箱" style="padding:0.7rem;border:1px solid #e0e0e0;border-radius:6px;font-size:1rem;">
      <input id="userLoginPwd" type="password" placeholder="密码" style="padding:0.7rem;border:1px solid #e0e0e0;border-radius:6px;font-size:1rem;">
      <div id="userLoginError" style="color:#e53935;font-size:0.98rem;display:none;"></div>
      <button class="submit-btn" onclick="return userLogin(event)">登录</button>
      <button class="submit-btn" style="background:#eee;color:#333;" onclick="closeUserLoginModal();return false;">取消</button>
      <div style="text-align:center;color:#888;font-size:0.98rem;">或使用社交账号登录</div>
      <div style="display:flex;gap:1rem;justify-content:center;">
        <button class="submit-btn" style="background:#07c160;" onclick="alert('微信登录暂未接入')">微信</button>
        <button class="submit-btn" style="background:#498ad5;" onclick="alert('QQ登录暂未接入')">QQ</button>
        <button class="submit-btn" style="background:#e6162d;" onclick="alert('微博登录暂未接入')">微博</button>
      </div>
    </div>
  </div>
  <!-- 会员中心弹窗 -->
  <div id="memberCenterModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);z-index:102;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:2rem 2.2rem;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.08);min-width:260px;max-width:90vw;display:flex;flex-direction:column;gap:1.2rem;">
      <div style="font-weight:700;font-size:1.2rem;color:#1a73e8;">会员中心</div>
      <div id="memberInfo">请先登录</div>
      <button class="submit-btn" style="background:#eee;color:#333;" onclick="closeMemberCenter();return false;">关闭</button>
    </div>
  </div>
  <!-- 管理员登录弹窗 -->
  <div id="loginModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);z-index:100;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:2rem 2.2rem;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.08);min-width:260px;max-width:90vw;display:flex;flex-direction:column;gap:1.2rem;">
      <div style="font-weight:700;font-size:1.2rem;color:#1a73e8;">管理员登录</div>
      <input id="loginUser" type="text" placeholder="账户" style="padding:0.7rem;border:1px solid #e0e0e0;border-radius:6px;font-size:1rem;">
      <input id="loginPwd" type="password" placeholder="密码" style="padding:0.7rem;border:1px solid #e0e0e0;border-radius:6px;font-size:1rem;">
      <div id="loginError" style="color:#e53935;font-size:0.98rem;display:none;"></div>
      <button class="submit-btn" onclick="return loginAdmin(event)">登录</button>
      <button class="submit-btn" style="background:#eee;color:#333;" onclick="closeLoginModal();return false;">取消</button>
    </div>
  </div>
  <script>
    // 管理员面板显示/隐藏
    function toggleAdminPanel() {
      const panel = document.getElementById('adminPanel');
      panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
    }
    // 获取通知权限
    function requestNotify() {
      if (!('Notification' in window)) {
        alert('当前浏览器不支持通知功能');
        return;
      }
      Notification.requestPermission().then(function(permission) {
        if (permission === 'granted') {
          alert('通知权限已获取！');
        } else {
          alert('通知权限被拒绝');
        }
      });
    }
    // 简单的本地内容流（可替换为后端API）
    const demoPosts = [
      {
        author: '管理员',
        content: '欢迎来到 MULINHUA 朋友圈！',
        image: ''
      },
      {
        author: '管理员',
        content: '支持手机推送通知，记得点击上方按钮获取权限。',
        image: ''
      }
    ];
    function renderFeed() {
      const feed = document.getElementById('feed');
      feed.innerHTML = '';
      demoPosts.slice().reverse().forEach((post, idx) => {
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `<div class="author">${post.author}</div>
          <div class="content">${post.content}</div>
          ${post.image ? `<img src="${post.image}" alt="图片">` : ''}
          <div style="display:flex;gap:1rem;align-items:center;margin-top:0.5rem;">
            <button onclick="likePost(${idx})">👍<span id="like${idx}">${post.likes||0}</span></button>
            <button onclick="favPost(${idx})">⭐<span id="fav${idx}">${post.favs||0}</span></button>
            <button onclick="sharePost(${idx})">🔗分享</button>
          </div>
          <div style="margin-top:0.5rem;">
            <b>标签：</b>${post.tags||'无'}
            <b style="margin-left:1em;">分类：</b>${post.category||'未分类'}
            <b style="margin-left:1em;">归档：</b>${post.archive||'2025-06'}
            ${post.top?' <span style="color:#e53935;font-weight:700;">[置顶]</span>':''}
            ${post.recommend?' <span style="color:#1a73e8;font-weight:700;">[推荐]</span>':''}
          </div>
          <div style="margin-top:0.5rem;"><b>相关文章：</b>${post.related||'无'}</div>
          <div style="margin-top:0.5rem;">
            <b>评论：</b>
            <div id="comments${idx}">${(post.comments||[]).map(c=>`<div style='border-bottom:1px solid #eee;padding:2px 0;'><b>${c.user}：</b>${c.text}</div>`).join('')}</div>
            <form onsubmit="return addComment(event,${idx})" style="display:flex;gap:0.5rem;margin-top:0.3rem;">
              <input type="text" id="commentInput${idx}" placeholder="写评论..." style="flex:1;padding:0.3rem 0.5rem;border-radius:4px;border:1px solid #eee;">
              <button type="submit">发送</button>
            </form>
          </div>
        `;
        feed.appendChild(div);
      });
    }
    renderFeed();
    // 管理员发布内容（本地演示）
    function submitPost(e) {
      e.preventDefault();
      const content = document.getElementById('postContent').value.trim();
      const imageInput = document.getElementById('postImage');
      if (!content) return false;
      if (imageInput.files && imageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          demoPosts.push({ author: '管理员', content, image: evt.target.result });
          renderFeed();
        };
        reader.readAsDataURL(imageInput.files[0]);
      } else {
        demoPosts.push({ author: '管理员', content, image: '' });
        renderFeed();
      }
      document.getElementById('postForm').reset();
      return false;
    }
    // 管理员登录逻辑
    const ADMIN_USER = 'admin';
    const ADMIN_PWD = 'mulin2025';
    function isAdminLoggedIn() {
      return localStorage.getItem('mlh_admin') === '1';
    }
    function showLoginModal() {
      if (isAdminLoggedIn()) {
        document.getElementById('adminPanel').style.display = 'flex';
        return;
      }
      document.getElementById('loginModal').style.display = 'flex';
      document.getElementById('loginError').style.display = 'none';
      document.getElementById('loginUser').value = '';
      document.getElementById('loginPwd').value = '';
    }
    function closeLoginModal() {
      document.getElementById('loginModal').style.display = 'none';
    }
    function loginAdmin(e) {
      e.preventDefault();
      const user = document.getElementById('loginUser').value.trim();
      const pwd = document.getElementById('loginPwd').value;
      if (user === ADMIN_USER && pwd === ADMIN_PWD) {
        localStorage.setItem('mlh_admin', '1');
        document.getElementById('adminPanel').style.display = 'flex';
        document.getElementById('adminBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
        closeLoginModal();
      } else {
        document.getElementById('loginError').innerText = '账户或密码错误';
        document.getElementById('loginError').style.display = 'block';
      }
      return false;
    }
    function logoutAdmin() {
      localStorage.removeItem('mlh_admin');
      document.getElementById('adminPanel').style.display = 'none';
      document.getElementById('adminBtn').style.display = 'inline-block';
      document.getElementById('logoutBtn').style.display = 'none';
    }
    // 用户登录/注册弹窗逻辑
    function showUserLoginModal() {
      document.getElementById('userLoginModal').style.display = 'flex';
      document.getElementById('userLoginError').style.display = 'none';
      document.getElementById('userLoginUser').value = '';
      document.getElementById('userLoginPwd').value = '';
    }
    function closeUserLoginModal() {
      document.getElementById('userLoginModal').style.display = 'none';
    }
    function userLogin(e) {
      e.preventDefault();
      // 这里只做本地演示，实际应调用后端API
      const user = document.getElementById('userLoginUser').value.trim();
      const pwd = document.getElementById('userLoginPwd').value;
      if (user && pwd) {
        localStorage.setItem('mlh_user', user);
        closeUserLoginModal();
        updateMemberInfo();
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('memberBtn').style.display = 'inline-block';
      } else {
        document.getElementById('userLoginError').innerText = '请输入用户名和密码';
        document.getElementById('userLoginError').style.display = 'block';
      }
      return false;
    }
    // 会员中心逻辑
    function showMemberCenter() {
      document.getElementById('memberCenterModal').style.display = 'flex';
      updateMemberInfo();
    }
    function closeMemberCenter() {
      document.getElementById('memberCenterModal').style.display = 'none';
    }
    function updateMemberInfo() {
      const user = localStorage.getItem('mlh_user');
      document.getElementById('memberInfo').innerText = user ? `欢迎，${user}` : '请先登录';
    }
    // 页面加载时根据登录状态显示用户按钮
    window.onload = function() {
      if (isAdminLoggedIn()) {
        document.getElementById('adminPanel').style.display = 'flex';
        document.getElementById('adminBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
      } else {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('adminBtn').style.display = 'inline-block';
        document.getElementById('logoutBtn').style.display = 'none';
      }
      if (localStorage.getItem('mlh_user')) {
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('memberBtn').style.display = 'inline-block';
      } else {
        document.getElementById('loginBtn').style.display = 'inline-block';
        document.getElementById('memberBtn').style.display = 'none';
      }
    }
    function likePost(idx) {
      demoPosts[idx].likes = (demoPosts[idx].likes||0)+1;
      document.getElementById('like'+idx).innerText = demoPosts[idx].likes;
    }
    function favPost(idx) {
      demoPosts[idx].favs = (demoPosts[idx].favs||0)+1;
      document.getElementById('fav'+idx).innerText = demoPosts[idx].favs;
    }
    function sharePost(idx) {
      alert('分享功能仅为演示，可对接微信/QQ/微博/复制链接等');
    }
    function addComment(e, idx) {
      e.preventDefault();
      const input = document.getElementById('commentInput'+idx);
      const text = input.value.trim();
      if (!text) return false;
      if (!demoPosts[idx].comments) demoPosts[idx].comments = [];
      const user = localStorage.getItem('mlh_user') || '游客';
      demoPosts[idx].comments.push({user, text});
      renderFeed();
      return false;
    }
  </script>
</body>
</html>
